name: Update THM Stats
on:
  schedule:
    - cron: '0 */6 * * *' # Roda a cada 6 horas
  workflow_dispatch:      # Permite rodar manualmente pelo painel do GitHub

jobs:
  update-stats:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Fetch THM Data
        run: |
          # Baixa o JSON da API
          curl -s "https://tryhackme.com/api/v2/public-profile?username=0xK4z" > thm_full.json
          
          # Usa o comando 'jq' para extrair os campos e salvar no thm.yml
          # Se o seu runner não tiver jq, ele é instalado por padrão no ubuntu-latest
          echo "streak: $(jq -r '.streak // 0' thm_full.json)" > _data/thm.yml
          echo "rank: $(jq -r '.rank // 0' thm_full.json)" >> _data/thm.yml
          echo "top_percentage: $(jq -r '.topPercentage // 0' thm_full.json)" >> _data/thm.yml
          
      - name: Commit and Push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add _data/thm.yml
          git commit -m "Update THM stats: $(date -u)" || exit 0
          git push