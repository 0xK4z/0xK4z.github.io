name: Update THM Stats
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update-stats:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Fetch THM Data
        run: |
          curl -s "https://tryhackme.com/api/v2/public-profile?username=0xK4z" > thm_full.json

          echo "streak: $(jq -r '.data.streak // 0' thm_full.json)" > _data/thm.yml
          echo "rank: $(jq -r '.data.rank // 0' thm_full.json)" >> _data/thm.yml
          echo "topPercentage: $(jq -r '.data.topPercentage // 0' thm_full.json)" >> _data/thm.yml
          
      - name: Commit and Push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add _data/thm.yml
          git commit -m "Update THM stats: $(date -u)" || exit 0
          git push

      - name: Trigger Deploy
        # Substitua 'deploy.yml' pelo nome real do seu arquivo de workflow de deploy
        run: gh workflow run jekyll.yml
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}